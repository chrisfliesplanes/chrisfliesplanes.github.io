<!DOCTYPE html>
<html>
  <head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
<script type="text/javascript">

	var map;
	var markers = []
	var polylines = []
	
	// JSON request using a CORS proxy
	function setMarkers(map) {
		jQuery.extend({
			getValues: function(url) {
				var result = null;
				$.ajax({
					url: 'https://taptill.herokuapp.com/radar',
					type: 'get',
					dataType: 'json',
					async: false,
					success: function(data) {
						result = data;
					}
				});
			return result;
			}
		});
		

	var data = $.getValues("url string");
		for (var i = 0; i < data.acList.length; i++) {
			var aircraft = data.acList[i]
			if("Long" in aircraft && "Lat" in aircraft){
				if("Cot" in aircraft){
					var polyCoords = []
					for (var i2 = 0; i2 < aircraft.Cot.length; i2+=3) {
						var polyLatLng = {};
						polyLatLng['lat'] = aircraft.Cot[i2]
						polyLatLng['lng'] = aircraft.Cot[i2 + 1]
						polyCoords.push(polyLatLng)	
					};
					var lineSymbol = {
						path: 'M 0,-1 0,1',
						strokeOpacity: 1,
						scale: 2
};
					var flightPath = new google.maps.Polyline({
						path: polyCoords,
						strokeOpacity: 0,
						icons: [{
							icon: lineSymbol,
							offset: '0',
							repeat: '10px'
						}]
					});
					
					flightPath.setMap(map);
				}
				var latLng = new google.maps.LatLng(aircraft.Lat,aircraft.Long);
				var string = aircraft.Mdl
				string += " - "
				string += aircraft.Call
				string += " - "
				string += aircraft.Alt
				var image = {
					url: 'icon.png',
					size: new google.maps.Size(24, 24),
					origin: new google.maps.Point(0, 0),
					anchor: new google.maps.Point(12, 12)
				};
				var marker = new google.maps.Marker({
					position: latLng,
					map: map,
					title: string,
					icon: image
				});
				markers.push(marker)
				polylines.push(flightPath)
			};
		};
	};

	function removeMarkers(){
		var i;
		for(i=0;i<markers.length;i++){
			markers[i].setMap(null);
		}
		markers = [];
		for(i=0;i<polylines.length;i++){
			polylines[i].setMap(null);
		}
		polylines = [];
	}
	function initMap() {
		map = new google.maps.Map(document.getElementById('map'), {
			zoom: 6,
			center: new google.maps.LatLng(53.509865, -4.118092),
			mapTypeId: 'terrain'
		});
		setMarkers(map)
	}
	
	setInterval(function(){
		removeMarkers();
		setMarkers(map);
	}, 20000);
	
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUPbxxvnqGrmKVj7ZzHwrDhKP5aFpoaaA&callback=initMap">
</script>
</body>
</html>
